<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.10.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ME 405 Term Project: Thermal Imaging Nerf Turret: Main Page</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">ME 405 Term Project: Thermal Imaging Nerf Turret<span id="projectnumber">&#160;1.0</span>
   </div>
   <div id="projectbrief">A library that contains software used to control and fire an automated Nerf turret. The turret uses a MLX90640 Thermal Imaging camera to determine opponent&#39;s position and fire.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('index.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<div><div class="header">
  <div class="headertitle"><div class="title">Main Page </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="Software"></a>
Software</h1>
<p>This section details the software used in the control and design of the ME 405 term project turret.</p>
<h2><a class="anchor" id="subsection1"></a>
Motor Driver</h2>
<p>The Motor Driver is a class that runs any 12 V DC motor using a L6206 H-Bridge motor driver. The software was implemented to the control the PWM and the speed at which the 12 V 50:1 gearmotor is to run when turning around to shoot any player on the other side of the turret.</p>
<h2><a class="anchor" id="subsection2"></a>
Controller</h2>
<p>This a general Proportional Controller class that can be used with any generic motor. The class is able to output an error from a specified desired position with a specified gain to generate an actuation value necessary for the motor to spin to get to the desired position. The software is implemented to control how far the turret needs to turn and face the opponent before shooting a dart.</p>
<h2><a class="anchor" id="subsection3"></a>
Encoder</h2>
<p>The encoder class implements the STM32's quadature encoder functionality to: initlialize encoder pins and timers, read current encoder position, and set the current encoder position to zero.</p>
<h2><a class="anchor" id="subsection4"></a>
mlx_cam</h2>
<p>This is a thermal imaging class that uses a <a class="el" href="classsrc_1_1_m_l_x90640.html">MLX90640</a> Thermal Imaging Camera from Adafruit to take a 32x24 sized thermal picture and return them as either a CSV file or an ASCII art. This software was implemented to determine the horizontal position of the opponent that is 20 ft. from the turret's position.</p>
<h2><a class="anchor" id="subsection5"></a>
Panning</h2>
<p>This script is a cooperative multitasking program which implements all four of the above classes to aim and fire at a target using the <a class="el" href="classsrc_1_1_m_l_x90640.html">MLX90640</a> thermal camera. See the Tasks section for more details.</p>
<h1><a class="anchor" id="Tasks"></a>
Tasks</h1>
<p>This section details the cooperative multitasking program in <a class="el" href="_panning_8py.html" title="This file contains a program that runs three separate tasks which take thermal images of the MLX90640...">Panning.py</a>.</p>
<p><a class="el" href="_panning_8py.html" title="This file contains a program that runs three separate tasks which take thermal images of the MLX90640...">Panning.py</a> consists of three tasks: motor_control, pusher_control, and camera. The motor_control task is used to pan the turret 180 degrees away from the opposing turret and prepare to shoot at a location specified by the <a class="el" href="classsrc_1_1_m_l_x90640.html">MLX90640</a> camera's feedback. <a class="el" href="#subsection6">Task 1: motor_control</a> details Task 1 and the states that compose it, which allow the turret to pan, aim, and return to its home position. The pusher_control task simply controls the timing of a pusher motor to fire a dart. <a class="el" href="#subsection7">Task 2: pusher_control</a> details Task 2 and the states that compose it, which push a dart from a magazine through a set of flywheels. Finally, the camera task communicates with an <a class="el" href="classsrc_1_1_m_l_x90640.html">MLX90640</a> Thermal Imaging Camera to take a picture of opponents standing opposite of the turret and is used to determine their location. <a class="el" href="#subsection8">Task 3: camera</a> details Task 3 and the states that compose it, which take a thermal image opposite of the turret.</p>
<p>The figure below shows the task diagram of the <a class="el" href="_panning_8py.html" title="This file contains a program that runs three separate tasks which take thermal images of the MLX90640...">Panning.py</a> file that is used to control movement and actions of the turret.</p>
<div class="image">
<img src="PanningTaskDiagram.png" alt="" width="500"/>
<div class="caption">
Figure 1. Task Diagram for panning.py that controls both movement and ability to fire.</div></div>
<h2><a class="anchor" id="subsection6"></a>
Task 1: motor_control</h2>
<p>Task 1 controls the gear motor used to aim the blaster and controls the flywheels used to fire a dart. Additionally, it homes the blaster assembly to face 180 degrees away from the opposing team's turret.</p>
<h3><a class="anchor" id="sub1"></a>
State 0</h3>
<p>Initializes gear motor by creating an object of the motor_driver and encoder classes. Initializes flywheel motors by creating a timer channel object and a corresponding control pin. Sets up the homing limit switch pin and the user input switch pin which begins the firing sequence. Finally, the gear motor is turned on at a slow speed to beign homing the blaster assembly. Moves on to state 6.</p>
<h3><a class="anchor" id="sub2"></a>
State 1</h3>
<p>Waits for the user input switch to be pressed before moving on to state 2 to begin the firing sequence.</p>
<h3><a class="anchor" id="sub3"></a>
State 2</h3>
<p>Waits for five and a half seconds after user input button is pressed before setting a flag to tell the camera task to take a picture. Moves on to state 3 once this flag is set.</p>
<h3><a class="anchor" id="sub4"></a>
State 3</h3>
<p>Waits for the camera flag to be cleared by the camera task before calculating the desired encoder position. The desired encoder position is determined using the target location returned by the camera task. Creates an object of the controller class to initialize step response and aim at target. Moves on to state 4</p>
<h3><a class="anchor" id="sub5"></a>
State 4</h3>
<p>Turns on the flywheel motors and runs the aiming step response while checking for steady state. Once steady state has been achieved and the blaster assembly is aiming at the target, the doShoot flag is set to tells the pusher_control task to fire a dart. Finally, the desired encoder position is set to a position approximately 45 degrees from home. Moves to state 5.</p>
<h3><a class="anchor" id="sub6"></a>
State 5</h3>
<p>Once the doShoot flag has been cleared by the pusher_control task indicating that a dart has been fired, runs the step response to move back to 45 degrees from the home position. Once this position has been reached, the flywheel motors are turned off, the gear motor speed is set to slow, and the task moves on to state 6.</p>
<h3><a class="anchor" id="sub7"></a>
State 6</h3>
<p>Continues moving the gear motor until the homing limit switch is pressed. When the limit switch is pressed, home position has been reached and motor gets turned off. Moves on to state 1.</p>
<p>Figure 2 shown below shows the Finite State Machine of Task 1 and its various state transitions.</p>
<div class="image">
<img src="MotorControlFSM.png" alt="" width="500"/>
<div class="caption">
Figure 2. Finite State Machine diagram for Task 1: motor_control and its state transitions.</div></div>
<h2><a class="anchor" id="subsection7"></a>
Task 2: pusher_control</h2>
<p>Task 2 controls the timing of the pusher motor which pushes a dart from the magazine through the flywheels.</p>
<h3><a class="anchor" id="sub1"></a>
State 0</h3>
<p>Initializes pusher motor by creating an object of the motor_driver class. Initializes the pusher motor limit switch pin. Moves on to state 1.</p>
<h3><a class="anchor" id="sub2"></a>
State 1</h3>
<p>Waits for the doShoot flag to be set by the motor_control task when the blaster assembly is aiming at the target. Once flag is set, moves on to state 2.</p>
<h3><a class="anchor" id="sub3"></a>
State 2</h3>
<p>Begins moving pusher motor. Once the pusher motor limit switch is unpressed, moves to state 3.</p>
<h3><a class="anchor" id="sub4"></a>
State 3</h3>
<p>Continues moving pusher motor until the limit switch is pressed once again. Once limit switch is pressed, the pusher motor is stopped, the doShoot flag is cleared, and the task returns to state 1.</p>
<p>Fiugre 3 shown below shows the Finite State Machine of Task 2 and its state transitions to push darts from a magazine to a flywheel.</p>
<div class="image">
<img src="PusherControlFSM.png" alt="" width="500"/>
<div class="caption">
Figure 3. Finite State Machine diagram for Task 2: pusher_control and its state transitions.</div></div>
<h2><a class="anchor" id="subsection8"></a>
Task 3: camera</h2>
<p>Task 3 controls the <a class="el" href="classsrc_1_1_m_l_x90640.html">MLX90640</a> thermal camera to take a single picture and returns the column in which a target is standing relative to the camera's position.</p>
<h3><a class="anchor" id="sub1"></a>
State 0</h3>
<p>Initializes I2C communication with the <a class="el" href="classsrc_1_1_m_l_x90640.html">MLX90640</a> camera. Creates an object of the MLX_Cam class to set up picture taking. Moves on to state 1.</p>
<h3><a class="anchor" id="sub2"></a>
State 1</h3>
<p>Waits for the camera flag to be set by the motor_control task. Once this flag is set, a thermal image is captured in the form of a list of pixel data. This list is iterated through to determine which column the target is standing in. The column value is stored in the share called "pixelpos", and it is returned to the motor_control task. The camera flag is then cleared and the state self transitions to wait for another camera flag.</p>
<p>Figure 4 shown below shows the Finite State Machine of Task 3 and its state to take a single thermal image that will be processed for aiming.</p>
<div class="image">
<img src="CameraFSM.png" alt="" width="500"/>
<div class="caption">
Figure 4. Finite State Machine diagram for Task 3: camera and its state.</div></div>
 </div></div><!-- PageDoc -->
<a href="doxygen_crawl.html"/>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.10.0 </li>
  </ul>
</div>
</body>
</html>
